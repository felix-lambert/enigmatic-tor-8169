<link href="stylesheets/bootstrap-wizard.css" rel="stylesheet" />
<link href="stylesheets/chosen.css" rel="stylesheet" />

<style type="text/css">
      .wizard-modal p {
        margin: 0 0 10px;
        padding: 0;
      }

      #wizard-ns-detail-servers, .wizard-additional-servers {
        font-size: 12px;
        margin-top: 10px;
        margin-left: 15px;
      }
      #wizard-ns-detail-servers > li, .wizard-additional-servers li {
        line-height: 20px;
        list-style-type: none;
      }
      #wizard-ns-detail-servers > li > img {
        padding-right: 5px;
      }

      .wizard-modal .chzn-container .chzn-results {
        max-height: 150px;
      }
      .wizard-addl-subsection {
        margin-bottom: 40px;
      }
      .create-server-agent-key {
        margin-left: 15px; 
        width: 90%;
      }
    </style>

    <button id="open-wizard" class="btn btn-primary">
      Faire un transfert
    </button>

    <div class="wizard" id="satellite-wizard" data-title="Create Server">

      <!-- Step 1 Name & FQDN -->
      <div class="wizard-card" data-cardname="name">
        <h3>Nom du destinataire</h3>
        <div class="wizard-input-section">
          <p>
            Nom ou pseudo
          </p>
          <div class="form-group">
            <div class="col-sm-6">
              <input type="text" class="form-control" id="label" name="label" placeholder="Pseudo" data-validate="validateServerLabel">
            </div>
          </div>
        </div>

        <div class="wizard-input-section">
          <p>
            Email
          </p>

          <div class="form-group">
            <div class="col-sm-8">
              <input type="text" class="form-control" placeholder="Email"  />
            </div>
          </div>
        </div>
      </div>

      <div class="wizard-card wizard-card-overlay" data-cardname="services">
        <h3>Type de service</h3>

        <div class="alert hide">
          Sélectionnez le type de service qui a été effectué
        </div>

        <div class="wizard-input-section">
          <p>
            Please choose the services you'd like Panopta to
            monitor.  Any service you select will be given a default
            check frequency of 1 minute.
          </p>

          <select name="services" data-placeholder="Service List" style="width:350px;" class="chzn-select create-server-service-list form-control" multiple>

            <option value=""></option>
            <optgroup label="Basic">
              <option selected value="icmp.ping">Ping</option>
              <option selected value="tcp.ssh">SSH</option>
              <option value="tcp.ftp">FTP</option>
            </optgroup>
            <optgroup label="Web">
              <option selected value="tcp.http">HTTP</option>
              <option value="tcp.https">HTTP (Secure)</option>
              <option value="tcp.dns">DNS</option>
            </optgroup>
            <optgroup label="Email">
              <option value="tcp.pop">POP</option>
              <option value="tcp.imap">IMAP</option>
              <option value="tcp.smtp">SMTP</option>
              <option value="tcp.pops">POP (Secure)</option>
              <option value="tcp.imaps">IMAP (Secure)</option>
              <option value="tcp.smtps">SMTP (Secure)</option>
              <option value="tcp.http.exchange">Microsoft Exchange</option>
            </optgroup>
            <optgroup label="Databases">
              <option value="tcp.mysql">MySQL</option>
              <option value="tcp.postgres">PostgreSQL</option>
              <option value="tcp.mssql">Microsoft SQL Server</option>
            </optgroup>
          </select>
        </div>
      </div>

      <div class="wizard-card">
        <h3>Nom d'heures</h3>

        <div class="wizard-input-section">
          <p>
            Entrez le nombre d'heure
          </p>

          <div class="form-group">
            <div class="col-sm-8">
              <input type="text" class="form-control" placeholder="Nombre d'heures"  />
            </div>
          </div>
        </div>


        <div class="wizard-error">
          <div class="alert alert-error">
            <strong>There was a problem</strong> with your submission.
            Please correct the errors and re-submit.
          </div>
        </div>
  
        <div class="wizard-failure">
          <div class="alert alert-error">
            <strong>There was a problem</strong> submitting the form.
            Please try again in a minute.
          </div>
        </div>
  
        <div class="wizard-success">
          <div class="alert alert-success">
            <span class="create-server-name"></span>Server Created <strong>Successfully.</strong>
          </div>
  
          <a class="btn btn-default create-another-server">Faire un autre transfert</a>
          <span style="padding:0 10px">or</span>
          <a class="btn btn-success im-done">Terminé</a>
        </div>
      </div>
    </div>


  <div class="container_" ng-init="init()">
    <h3>Vous avez actuellement <span style="color:#F0978C">{{currentMoney}}</span> crédit(s)</h3>
    <div class="alert-error_" ng-show="errorRequest">{{errorRequest}}</div>
    <div class="mgv10">
      <span class="trBtn" ng-class="{'open' : tab == 1}" ng-click="tab = 1">Vos annonces</span>
      <span class="trBtn" ng-class="{'open' : tab == 2}" ng-click="tab = 2">Annonces qui vous intéresse</span>
    </div>
    <table ng-if="tab == 1" class="table">
      <thead>
        <tr>
          <th>Annonce</th>
          <th>Demandeur</th>
          <th>Date de la requête</th>
          <th>Prix proposé</th>
          <th>Status</th>
          <th>Prix final *</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="transac in transactionOwner">
          <td><a href="/announces/{{transac.announce._id}}">{{transac.announce.title}}</a></td>
        <td>{{transac.client.username}}</td>
        <td>{{transac.date | date:'medium'}}</td>
        <td><span ng-show="transac.clientprice" class="commentStyle">{{transac.clientprice}} crédit(s)</span></td>
        <td>{{transac.statusInformation}}</td>
        <td>{{transac.announce.price}} crédit(s)</td>
        <td>
          <span ng-if="transac.status == -1" style="color:red;">Annulé</span>
          <span ng-if="transac.status == 0 || (transac.status == 1 && transac.showAcceptLink == true)"><a ng-click="acceptTransac(transac)">Accepter</a> / <a ng-click="rejectTransac(transac)">Refuser</a></span>
          <span ng-if="transac.status == 1 && transac.showAcceptLink == false" style="color:orange">Accepté</span>
          <span ng-if="transac.status == 2" style="color:#19C919">Accepté</span>
          <span ng-if="transac.status == 3" style="color:#19C919">Terminé</span>
        </td>
      </tr>
    </tbody>
  </table>
  <table ng-if="tab == 2" class="table">
    <thead>
      <tr>
        <th>Annonce</th>
        <th>Auteur</th>
        <th>Date de la requête</th>
        <th>Prix proposé</th>
        <th>Status</th>
        <th>Prix final *</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="transac in transactionClient">
        <td><a href="/announces/{{transac.announce._id}}">{{transac.announce.title}}</a></td>
        <td>{{transac.owner.username}}</td>
        <td>{{transac.date | date:'medium'}}</td>
        <td><span ng-show="transac.clientprice" class="commentStyle">{{transac.clientprice}} crédit(s)</span></td>
        <td>{{transac.statusInformation}}</td>
        <td>{{transac.announce.price}} crédit(s)</td>
        <td>
          <span ng-if="transac.status == -1" style="color:red;">Annulé</span>
          <span ng-if="transac.status == 0 || (transac.status == 1 && transac.showAcceptLink == true)"><a ng-click="acceptTransac(transac)">Accepter</a> / <a ng-click="rejectTransac(transac)">Refuser</a></span>
          <span ng-if="transac.status == 1 && transac.showAcceptLink == false" style="color:orange">Accepté</span>
          <span ng-if="transac.status == 2">
            <div style="color:#19C919">Accepté</div>
            <div><a ng-click="signalTransacAsReceived(transac)">Reçu</a> / <a ng-click="signalTransacAsNotReceived(transac)">Non reçu</a></div>
          </span>
          <span ng-if="transac.status == 3" style="color:#19C919">Reçu</span>
        </td>
      </tr>
    </tbody>
  </table>
</div>
</div>

<script src="javascript/chosen.jquery.js"></script>
<script src="javascript/prettify.js" type="text/javascript"></script>
    <script src="javascript/bootstrap-wizard.js" type="text/javascript"></script>
    <script type="text/javascript">
      $(document).ready(function() {
        $.fn.wizard.logging = true;
        var wizard = $('#satellite-wizard').wizard({
          keyboard : false,
          contentHeight : 400,
          contentWidth : 700,
          backdrop: 'static'
        });
        
        $(".chzn-select").chosen();

        $('#fqdn').on('input', function() {
          if ($(this).val().length != 0) {
            $('#ip').val('').attr('disabled', 'disabled');
            $('#fqdn, #ip').parents('.form-group').removeClass('has-error has-success');
          } else {
            $('#ip').val('').removeAttr('disabled');
          }
        });

        var pattern = /\b(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\b/;
        x = 46;

        $('#ip').on('input', function() {
          if ($(this).val().length != 0) {
            $('#fqdn').val('').attr('disabled', 'disabled');
          } else {
            $('#fqdn').val('').removeAttr('disabled');
          }
        }).keypress(function(e) {
          if (e.which != 8 && e.which != 0 && e.which != x && (e.which < 48 || e.which > 57)) {
            console.log(e.which);
            return false;
          }
        }).keyup(function() {
          var $this = $(this);
          if (!pattern.test($this.val())) {
            //$('#validate_ip').text('Not Valid IP');
            console.log('Not Valid IP');
            $this.parents('.form-group').removeClass('has-error has-success').addClass('has-error');
            while ($this.val().indexOf("..") !== -1) {
              $this.val($this.val().replace('..', '.'));
            }
            x = 46;
          } else {
            x = 0;
            var lastChar = $this.val().substr($this.val().length - 1);
            if (lastChar == '.') {
              $this.val($this.val().slice(0, -1));
            }
            var ip = $this.val().split('.');
            if (ip.length == 4) {
              //$('#validate_ip').text('Valid IP');
              console.log('Valid IP');
              $this.parents('.form-group').removeClass('has-error').addClass('has-success');
            }
          }
        });

        wizard.on('closed', function() {
          wizard.reset();
        });

        wizard.on("reset", function() {
          wizard.modal.find(':input').val('').removeAttr('disabled');
          wizard.modal.find('.form-group').removeClass('has-error').removeClass('has-succes');
          wizard.modal.find('#fqdn').data('is-valid', 0).data('lookup', 0);
        });

        wizard.on("submit", function(wizard) {
          var submit = {
            "hostname": $("#new-server-fqdn").val()
          };
          
          this.log('seralize()');
          this.log(this.serialize());
          this.log('serializeArray()');
          this.log(this.serializeArray());
      
          setTimeout(function() {
            wizard.trigger("success");
            wizard.hideButtons();
            wizard._submitting = false;
            wizard.showSubmitCard("success");
            wizard.updateProgressBar(0);
          }, 2000);
        });
        
        wizard.el.find(".wizard-success .im-done").click(function() {
          wizard.hide();
          setTimeout(function() {
            wizard.reset(); 
          }, 250);
          
        });
      
        wizard.el.find(".wizard-success .create-another-server").click(function() {
          wizard.reset();
        });
      
        $(".wizard-group-list").click(function() {
          alert("Disabled for demo.");
        });

        $('#open-wizard').click(function(e) {
          e.preventDefault();
          wizard.show();
        });
      });

      function validateServerLabel(el) {
        var name = el.val();
        var retValue = {};

        if (name == "") {
          retValue.status = false;
          retValue.msg = "Please enter a label";
        } else {
          retValue.status = true;
        }

        return retValue;
      };

      function validateFQDN(el) {
        var $this = $(el);
        var retValue = {};

        if ($this.is(':disabled')) {
          // FQDN Disabled
          retValue.status = true;
        } else {
          if ($this.data('lookup') === 0) {
            retValue.status = false;
            retValue.msg = "Preform lookup first";
          } else {
            if ($this.data('is-valid') === 0) {
              retValue.status = false;
              retValue.msg = "Lookup Failed";
            } else {
              retValue.status = true;
            }
          }
        }

        return retValue;
      };

      function lookup() {
        // Normally a ajax call to the server to preform a lookup
        $('#fqdn').data('lookup', 1);
        $('#fqdn').data('is-valid', 1);
        $('#ip').val('127.0.0.1');
      };
    </script>